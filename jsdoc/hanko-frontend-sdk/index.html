<!DOCTYPE html>
<html lang="en">

<head>
  
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title> Home</title>

  <script src="https://cdn.jsdelivr.net/gh/google/code-prettify@master/loader/run_prettify.js"></script>
  <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
  <script src="./build/entry.js"></script>
  <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <!--[if lt IE 9]>
    <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
  <![endif]-->
  <link href="https://fonts.googleapis.com/css?family=Roboto:100,400,700|Inconsolata,700" rel="stylesheet">
  <link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.6.3/css/all.css" integrity="sha384-UHRtZLI+pbxtHCWp1t77Bi1L4ZtiqrqD80Kn4Z8NTSRyMA2Fd33n5dQ8lWUE00s/" crossorigin="anonymous">
  <link type="text/css" rel="stylesheet" href="https://jmblog.github.io/color-themes-for-google-code-prettify/themes/tomorrow-night.min.css">
  <link type="text/css" rel="stylesheet" href="styles/app.min.css">
  <link type="text/css" rel="stylesheet" href="styles/iframe.css">
  <link type="text/css" rel="stylesheet" href="">
  <script async defer src="https://buttons.github.io/buttons.js"></script>

  
</head>



<body class="layout small-header">
    <div id="stickyNavbarOverlay"></div>
    

<div class="top-nav">
    <div class="inner">
        <a id="hamburger" role="button" class="navbar-burger" aria-label="menu" aria-expanded="false">
            <span aria-hidden="true"></span>
            <span aria-hidden="true"></span>
            <span aria-hidden="true"></span>
        </a>
        <div class="logo">
            
            
        </div>
        <div class="menu">
            
            <div class="navigation">
                <a
                    href="index.html"
                    class="link"
                >
                    Documentation
                </a>
                
                
                
            </div>
        </div>
    </div>
</div>
    <div id="main">
        <div
            class="sidebar "
            id="sidebarNav"
        >
            
            <nav>
                
                    <h2><a href="index.html">Documentation</a></h2><div class="category"><h3>Classes</h3><ul><li><a href="Action_Action.html">Action</a></li><li><a href="Hanko.html">Hanko</a></li><li><a href="SessionState_SessionState.html">SessionState</a></li><li><a href="State_State.html">State</a></li><li><a href="WebauthnManager.html">WebauthnManager</a></li></ul><h3>Interfaces</h3><ul><li><a href="HankoOptions.html">HankoOptions</a></li></ul></div><div class="category"><h2>SDK</h2><h3>Classes / FlowAPI</h3><ul><li><a href="Action.html">Action</a></li><li><a href="State.html">State</a></li></ul><h3>Classes / Internal</h3><ul><li><a href="Client.html">Client</a></li><li><a href="Cookie.html">Cookie</a></li><li><a href="Dispatcher.html">Dispatcher</a></li><li><a href="Headers.html">Headers</a></li><li><a href="HttpClient.html">HttpClient</a></li><li><a href="Relay.html">Relay</a></li><li><a href="Response.html">Response</a></li><li><a href="Scheduler.html">Scheduler</a></li><li><a href="SessionChannel.html">SessionChannel</a></li><li><a href="SessionState.html">SessionState</a></li><li><a href="SessionStorage.html">SessionStorage</a></li><li><a href="Throttle.html">Throttle</a></li><li><a href="WindowActivityManager.html">WindowActivityManager</a></li></ul><h3>Classes / Errors</h3><ul><li><a href="ConflictError.html">ConflictError</a></li><li><a href="EmailAddressAlreadyExistsError.html">EmailAddressAlreadyExistsError</a></li><li><a href="ForbiddenError.html">ForbiddenError</a></li><li><a href="HankoError.html">HankoError</a></li><li><a href="InvalidPasscodeError.html">InvalidPasscodeError</a></li><li><a href="InvalidPasswordError.html">InvalidPasswordError</a></li><li><a href="InvalidWebauthnCredentialError.html">InvalidWebauthnCredentialError</a></li><li><a href="MaxNumOfEmailAddressesReachedError.html">MaxNumOfEmailAddressesReachedError</a></li><li><a href="MaxNumOfPasscodeAttemptsReachedError.html">MaxNumOfPasscodeAttemptsReachedError</a></li><li><a href="NotFoundError.html">NotFoundError</a></li><li><a href="PasscodeExpiredError.html">PasscodeExpiredError</a></li><li><a href="RequestTimeoutError.html">RequestTimeoutError</a></li><li><a href="TechnicalError.html">TechnicalError</a></li><li><a href="ThirdPartyError.html">ThirdPartyError</a></li><li><a href="TooManyRequestsError.html">TooManyRequestsError</a></li><li><a href="UnauthorizedError.html">UnauthorizedError</a></li><li><a href="UserVerificationError.html">UserVerificationError</a></li><li><a href="WebauthnRequestCancelledError.html">WebauthnRequestCancelledError</a></li></ul><h3>Classes / Events</h3><ul><li><a href="Listener.html">Listener</a></li></ul><h3>Classes / Clients</h3><ul><li><a href="SessionClient.html">SessionClient</a></li><li><a href="UserClient.html">UserClient</a></li></ul><h3>Classes / Utilities</h3><ul><li><a href="WebauthnSupport.html">WebauthnSupport</a></li></ul><h3>Interfaces / Internal</h3><ul><li><a href="BroadcastMessage.html">BroadcastMessage</a></li><li><a href="CookieOptions.html">CookieOptions</a></li><li><a href="HttpClientOptions.html">HttpClientOptions</a></li><li><a href="SessionStorageOptions.html">SessionStorageOptions</a></li><li><a href="ThrottleOptions.html">ThrottleOptions</a></li></ul><h3>Interfaces / DTO</h3><ul><li><a href="Email.html">Email</a></li><li><a href="Emails.html">Emails</a></li><li><a href="Identity.html">Identity</a></li><li><a href="SessionCheckResponse.html">SessionCheckResponse</a></li></ul><h3>Interfaces / Events</h3><ul><li><a href="SessionDetail.html">SessionDetail</a></li></ul><h3><a href="global.html">Global</a></h3></div>
                
            </nav>
        </div>
        <div class="core" id="main-content-wrapper">
            <div class="content">
                <header class="page-title">
                    <p></p>
                    <h1>Home</h1>
                </header>
                



    


    <h3> </h3>










    




    <section>
        <article><h1>hanko-frontend-sdk</h1>
<p>This package utilizes the <a href="https://github.com/teamhanko/hanko/blob/main/backend/README.md">Hanko API</a> to provide
functionality that allows an easier UI integration. It is meant for use in browsers only.</p>
<ul>
<li><a href="#installation">Installation</a></li>
<li><a href="#usage">Usage</a></li>
<li><a href="#options">Options</a></li>
<li><a href="#session-events">Session Events</a></li>
<li><a href="#session-management">Session Management</a>
<ul>
<li><a href="#getting-the-user-object">Getting the User Object</a></li>
<li><a href="#validating-a-session">Validating a Session</a></li>
<li><a href="#getting-the-session-token">Getting the Session Token</a></li>
<li><a href="#logging-out-a-user">Logging out a User</a></li>
</ul>
</li>
<li><a href="#translation-of-outgoing-emails">Translation of Outgoing Emails</a></li>
<li><a href="#custom-session-claim-type-safety">Custom Session Claim Type Safety</a></li>
<li><a href="#flowapi">FlowAPI</a>
<ul>
<li><a href="#initializing-a-new-flow">Initializing a New Flow</a></li>
<li><a href="#understanding-the-state-object">Understanding the State Object</a></li>
<li><a href="#action-availability">Action Availability</a></li>
<li><a href="#accessing-action-inputs">Accessing Action Inputs</a></li>
<li><a href="#running-an-action">Running an Action</a></li>
<li><a href="#event-handlers">Event Handlers</a></li>
<li><a href="#controlling-the-afterstatechanged-event">Controlling the AfterStateChanged Event</a></li>
<li><a href="#auto-steps">Auto-Steps</a></li>
<li><a href="#error-handling">Error Handling</a></li>
<li><a href="#caching-flow-state">Caching Flow State</a></li>
</ul>
</li>
<li><a href="#bugs">Bugs</a></li>
<li><a href="#documentation">Documentation</a></li>
<li><a href="#license">License</a></li>
</ul>
<h2>Installation</h2>
<pre class="prettyprint source lang-shell"><code># npm
npm install @teamhanko/hanko-frontend-sdk

# yarn
yarn add @teamhanko/hanko-frontend-sdk

# pnpm
pnpm install @teamhanko/hanko-frontend-sdk
</code></pre>
<h2>Usage</h2>
<p>Import as a module:</p>
<pre class="prettyprint source lang-typescript"><code>import { Hanko } from &quot;@teamhanko/hanko-frontend-sdk&quot;

const hanko = new Hanko(&quot;http://localhost:3000&quot;)
</code></pre>
<p>With a script tag via CDN:</p>
<pre class="prettyprint source lang-html"><code>&lt;script src=&quot;https://cdn.jsdelivr.net/npm/@teamhanko/hanko-frontend-sdk/dist/sdk.umd.js&quot;>&lt;/script>

&lt;script>
    const hanko = new hankoFrontendSdk.Hanko(&quot;http://localhost:3000&quot;)
    ...
&lt;/script>
</code></pre>
<h3>Options</h3>
<p>You can pass certain options, when creating a new <code>Hanko</code> instance:</p>
<pre class="prettyprint source lang-js"><code>const defaultOptions = {
  timeout: 13000,                                // The timeout (in ms) for the HTTP requests.
  cookieName: &quot;hanko&quot;,                           // The cookie name under which the session token is set.
  localStorageKey: &quot;hanko&quot;,                      // The prefix / name of the localStorage keys.
  sessionCheckInterval: 30000,                   // Interval (in ms) for session validity checks. Must be greater than 3000 (3s).
  sessionCheckChannelName: &quot;hanko-session-check&quot; // The broadcast channel name for inter-tab communication

};
const hanko = new Hanko(&quot;http://localhost:3000&quot;, defaultOptions);
</code></pre>
<h3>Session Events</h3>
<p>You can bind callback functions to different custom events. The callback function will be called when the event happens
and an object will be passed in, containing event details. The event binding works as follows:</p>
<pre class="prettyprint source lang-typescript"><code>// Controls the optional `once` parameter. When set to `true` the callback function will be called only once.
const once = false;

const removeEventListener = hanko.onSessionCreated((eventDetail) => {
    // Your code...
}, once);
</code></pre>
<p>The following events are available:</p>
<ul>
<li>&quot;hanko-session-created&quot;: Will be triggered after a session has been created and the user has completed possible
additional steps (e.g. passkey registration or password recovery). It will also be triggered when the user logs in via
another browser window. The event can be used to obtain the JWT claims.</li>
</ul>
<pre class="prettyprint source lang-js"><code>hanko.onSessionCreated((sessionDetail) => {
  // A new JWT has been issued.
    console.info(&quot;Session created&quot;, sessionDetail.claims);
})
</code></pre>
<ul>
<li>&quot;hanko-session-expired&quot;: Will be triggered when the session has expired, or when the session has been removed in
another browser window, because the user has logged out, or deleted the account.</li>
</ul>
<pre class="prettyprint source lang-js"><code>hanko.onSessionExpired(() => {
  // You can redirect the user to a login page or show the `&lt;hanko-auth>` element, or to prompt the user to log in again.
  console.info(&quot;Session expired&quot;);
})
</code></pre>
<ul>
<li>&quot;hanko-user-logged-out&quot;: Will be triggered, when the user actively logs out. In other browser windows, a &quot;hanko-session-expired&quot; event
will be triggered at the same time.</li>
</ul>
<pre class="prettyprint source lang-js"><code>hanko.onUserLoggedOut(() => {
  // You can redirect the user to a login page or show the `&lt;hanko-auth>` element.
  console.info(&quot;User logged out&quot;);
})
</code></pre>
<ul>
<li>&quot;hanko-user-deleted&quot;: Will be triggered when the user has deleted the account. In other browser windows, a &quot;hanko-session-expired&quot; event
will be triggered at the same time.</li>
</ul>
<pre class="prettyprint source lang-js"><code>hanko.onUserDeleted(() => {
  // You can redirect the user to a login page or show the `&lt;hanko-auth>` element.
  console.info(&quot;User has been deleted&quot;);
})
</code></pre>
<p>Please Take a look into the <a href="https://teamhanko.github.io/hanko/jsdoc/hanko-frontend-sdk/">docs</a> for more details.</p>
<h3>Session Management</h3>
<p>The SDK provides methods to manage user sessions and retrieve user information.</p>
<h4>Getting the User Object</h4>
<p>Fetches the current user's profile information.</p>
<ul>
<li><strong>Returns</strong>: A <code>User</code> object containing the user’s profile details. The object includes:
<ul>
<li><code>user_id</code>: A unique string identifier for the user.</li>
<li><code>passkeys</code>: An optional array of WebAuthn credentials (passkey-based authentication).</li>
<li><code>security_keys</code>: An optional array of WebAuthn credentials (security key-based authentication).</li>
<li><code>mfa_config</code>: An optional configuration object for multi-factor authentication settings.</li>
<li><code>emails</code>: An optional array of email objects (e.g., <code>{ address: string, is_primary: boolean, is_verified: boolean }</code>).</li>
<li><code>username</code>: An optional username object (e.g., <code>{ id: string, username: string }</code>).</li>
<li><code>created_at</code>: A string timestamp (ISO 8601) of when the user was created.</li>
<li><code>updated_at</code>: A string timestamp (ISO 8601) of when the user was last updated.</li>
</ul>
</li>
<li><strong>Errors</strong>: <code>UnauthorizedError</code> (invalid or expired session), <code>TechnicalError</code> (server or network issues).</li>
</ul>
<pre class="prettyprint source lang-typescript"><code>try {
    const user = await hanko.getUser();
    console.log(&quot;User profile:&quot;, user);
    // Example output:
    // {
    //   user_id: &quot;123e4567-e89b-12d3-a456-426614174000&quot;,
    //   emails: [{ address: &quot;user@example.com&quot;, is_primary: true, is_verified: true }],
    //   username: { id: &quot;f2882293-3c39-451d-a7cb-4cf3375e0c66&quot;, username: &quot;johndoe&quot; },
    //   created_at: &quot;2025-01-01T10:00:00Z&quot;,
    //   updated_at: &quot;2025-04-01T12:00:00Z&quot;
    // }
} catch (error) {
    console.error(&quot;Failed to fetch user profile:&quot;, error);
    // Handle UnauthorizedError or TechnicalError
}
</code></pre>
<h4>Validating a Session</h4>
<p>Checks the validity of the current session.</p>
<ul>
<li><strong>Returns</strong>: A SessionCheckResponse object containing:
<ul>
<li><code>is_valid</code>: A boolean indicating whether the session is valid.</li>
<li><code>claims</code>: An optional object with session details, including:
<ul>
<li><code>subject</code>: The user ID or session identifier.</li>
<li><code>session_id</code>: The unique session identifier.</li>
<li><code>expiration</code>: A string timestamp (ISO 8601) when the session expires.</li>
<li><code>email</code>: An optional object with email details (e.g., <code>{ address: string, is_primary: boolean, is_verified: boolean }</code>).</li>
<li><code>username</code>: An optional string with the user’s username.</li>
<li><code>issued_at</code>, <code>audience</code>, <code>issuer</code>: Optional metadata about the session token.</li>
<li>Custom claims (defined by the application).</li>
</ul>
</li>
</ul>
</li>
<li><strong>Errors</strong>: TechnicalError (server or network issues).</li>
</ul>
<pre class="prettyprint source lang-typescript"><code>try {
    const sessionStatus = await hanko.validateSession();
    console.log(&quot;Session status:&quot;, sessionStatus);
    // Example output:
    // {
    //   is_valid: true,
    //   claims: {
    //     subject: &quot;123e4567-e89b-12d3-a456-426614174000&quot;,
    //     session_id: &quot;789abc&quot;,
    //     expiration: &quot;2025-04-25T12:00:00Z&quot;,
    //     email: { address: &quot;user@example.com&quot;, is_primary: true, is_verified: true },
    //     custom_field: &quot;value&quot;
    //   }
    // }
} catch (error) {
    console.error(&quot;Failed to validate session:&quot;, error);
    // Handle TechnicalError
}
</code></pre>
<h4>Getting the Session Token</h4>
<p>Retrieves the current session token from the authentication cookie.</p>
<ul>
<li><strong>Returns</strong>: A string containing the JWT session token or <code>null</code> if no session exists.</li>
<li><strong>Note</strong>: This method does not throw errors; check for <code>null</code> to handle missing sessions.</li>
</ul>
<pre class="prettyprint source lang-typescript"><code>const token = hanko.getSessionToken();
console.log(&quot;Session token:&quot;, token);
// Example output: &quot;eyJhbGciOiJIUzI1NiIs...&quot;
</code></pre>
<h4>Logging out a User</h4>
<p>Logs out the current user by invalidating the session.</p>
<ul>
<li><strong>Returns</strong>: A promise that resolves with no value on successful logout or throws an error.</li>
<li><strong>Errors</strong>: <code>TechnicalError</code> (server or network issues).</li>
<li><strong>Note</strong>: If no session exists, the method resolves without error.</li>
</ul>
<pre class="prettyprint source lang-typescript"><code>try {
    await hanko.logout();
    console.log(&quot;User logged out&quot;);
} catch (error) {
    console.error(&quot;Failed to fetch user logout:&quot;, error);
    // Handle TechnicalError
}
</code></pre>
<h3>Translation of outgoing emails</h3>
<p>If you use the main <code>Hanko</code> client provided by the Frontend SDK, you can use the <code>lang</code> parameter in the options when
instantiating the client to configure the language that is used to convey to the Hanko API the
language to use for outgoing emails. If you have disabled email delivery through Hanko and configured a webhook for the
<code>email.send</code> event, the value for the <code>lang</code> parameter is reflected in the JWT payload of the token contained in the
webhook request in the &quot;Language&quot; claim.</p>
<h3>Custom session claim type safety</h3>
<p>The Hanko backend allows you to define custom claims that are added to issued session JWTs
(see <a href="https://github.com/teamhanko/hanko/blob/main/backend/README.md#session-jwt-templates">here</a> for more info).</p>
<p>To allow for IDE autocompletion and to maintain type safety for your custom claims:</p>
<ol>
<li>Create a TypeScript definition file (<code>*.d.ts</code>) in your project (alternatively, modify an existing one).</li>
<li>Import the <code>Claims</code> type from the frontend SDK.</li>
<li>Declare a custom type that extends the <code>Claims</code> type.</li>
<li>Add your custom claims to your custom type.</li>
</ol>
<pre class="prettyprint source lang-ts"><code>import type { Claims } from &quot;@teamhanko/hanko-frontend-sdk&quot; // 2.
// import type { Claims } from &quot;@teamhanko/elements&quot;        // alternatively, if you use Hanko Elements, which
                                                            // re-exports most SDK types


type CustomClaims = Claims&lt;{                                // 3.
    custom_claim?: string                                   // 4.
}>;
</code></pre>
<ol start="5">
<li>Use your custom type when accessing claims, e.g. in session details received in event callbacks or when accessing
claims in responses from session validation
<a href="https://docs.hanko.io/api-reference/public/session-management/validate-a-session">endpoints</a>:</li>
</ol>
<pre class="prettyprint source lang-ts"><code>import type { CustomClaims } from &quot;...&quot;; // path to your type declaration file

hanko.onSessionCreated((sessionDetail) => {
  const claims = sessionDetail.claims as CustomClaims;
  console.info(&quot;My custom claim:&quot;, claims.custom_claim);
});
</code></pre>
<pre class="prettyprint source lang-ts"><code>import type { CustomClaims } from &quot;...&quot;; // path to your type declaration file

async function session() {
    const session = await hanko.validateSession();
    const claims = session.claims as CustomClaims;
    console.info(&quot;My custom claim:&quot;, claims.custom_claim);
};
</code></pre>
<h2>FlowAPI</h2>
<p>The SDK offers a TypeScript-based interface for managing authentication and profile flows with Hanko, enabling the
development of custom frontends with the Hanko FlowAPI. It handles state transitions, action execution, input
validation, and event dispatching, while also providing built-in support for auto-stepping and passkey autofill.
This guide explores its core functionality and usage patterns.</p>
<h3>Initializing a New Flow</h3>
<p>Start a new authentication or profile flow using the <code>createState</code> method on a Hanko instance. Options allow you to control
event dispatching and auto-step behavior.</p>
<pre class="prettyprint source lang-typescript"><code>const state = await hanko.createState(&quot;login&quot;, {
    dispatchAfterStateChangeEvent: true,
    excludeAutoSteps: [],
    loadFromCache: true,
    cacheKey: &quot;hanko-flow-state&quot;,
});
</code></pre>
<h4>Parameters</h4>
<ul>
<li><strong>flowName</strong>: The name of the flow (e.g., &quot;login&quot;, &quot;register&quot; or &quot;profile&quot;).</li>
<li><strong>options</strong>:
<ul>
<li><strong>dispatchAfterStateChangeEvent</strong>: <code>boolean</code> - Whether to dispatch the onAfterStateChange event after state changes (default: true).</li>
<li><strong>excludeAutoSteps</strong>: <code>AutoStepExclusion</code> - Array of state names or &quot;all&quot; to skip specific or all auto-steps (default: null).</li>
<li><strong>loadFromCache</strong>: <code>boolean</code> - Whether to attempt loading a cached state from localStorage (default: true).</li>
<li><strong>cacheKey</strong>: <code>string</code> - The key used for localStorage caching (default: &quot;hanko-flow-state&quot;).</li>
</ul>
</li>
</ul>
<h3>Understanding the State Object</h3>
<p>The <code>state</code> object represents the current step in the flow. It contains properties and methods to interact with the flow.</p>
<h4>Structure</h4>
<ul>
<li><strong>name</strong>: <code>StateName</code> - The current state’s name (e.g., &quot;login_init&quot;, &quot;login_password&quot;, &quot;success&quot;).</li>
<li><strong>flowName</strong>: <code>FlowName</code> - The name of the flow (e.g., &quot;login&quot;).</li>
<li><strong>error</strong>: <code>Error | undefined</code> - An error object if an action or request fails (e.g., invalid input, network error).</li>
<li><strong>payload</strong>: <code>Payloads[StateName] | undefined</code> - State-specific data returned by the API.</li>
<li><strong>actions</strong>: <code>ActionMap&lt;StateName&gt;</code> - An object mapping action names to Action instances.</li>
<li><strong>csrfToken</strong>: <code>string</code> - CSRF token for secure requests.</li>
<li><strong>status</strong>: <code>number</code> - HTTP status code of the last response.</li>
<li><strong>invokedAction</strong>: <code>ActionInfo | undefined</code> - Details of the last action run on this state, if any.</li>
<li><strong>previousAction</strong>: <code>ActionInfo | undefined</code> - Details of the action that led to this state, if any.</li>
<li><strong>isCached</strong>: <code>boolean</code> - Whether the state was loaded from localStorage.</li>
<li><strong>cacheKey</strong>: <code>string</code> - The key used for localStorage caching.</li>
<li><strong>excludeAutoSteps</strong>: <code>AutoStepExclusion</code> - An array of <code>StateNames</code> excluded from auto-stepping.</li>
</ul>
<h3>Action Availability</h3>
<p>Actions can be enabled or disabled based on the backend configuration or the user's state and properties. You can check
whether a specific action is enabled by accessing its <code>enabled</code> property:</p>
<pre class="prettyprint source lang-typescript"><code>if (state.actions.example_action.enabled) {
  await state.actions.example_action.run();
} else {
  console.log(&quot;Action is disabled&quot;);
}
</code></pre>
<h3>Accessing Action Inputs</h3>
<p>Each action in <code>state.actions</code> has an <code>inputs</code> property defining expected input fields.</p>
<pre class="prettyprint source lang-typescript"><code>console.log(state.actions.continue_with_login_identifier.inputs);
// Example output:
// {
//   username: {
//     required: true,
//     type: &quot;string&quot;,
//     minLength: 3,
//     maxLength: 20,
//     description: &quot;User’s login name&quot;
//   }
// }
</code></pre>
<h3>Running an Action</h3>
<p>Actions transition the flow to a new state. Use the <code>run</code> method on an action, passing input values and optional configuration.</p>
<h4>Basic Example with Type Narrowing</h4>
<pre class="prettyprint source lang-typescript"><code>if (state.name === &quot;login_init&quot;) {
  const newState = await state.actions.continue_with_login_identifier.run({
    username: &quot;user1&quot;,
  });
  // Triggers `onBeforeStateChange` and `onAfterStateChange` events
  // `newState` is the next state in the flow (e.g., &quot;login_password&quot;)
}
</code></pre>
<h4>Additional Considerations</h4>
<ul>
<li><strong>Type Narrowing</strong>: Check <code>state.name</code> to ensure the action exists and inputs are valid for that state.</li>
<li><strong>Events</strong>: By default, <code>run</code> triggers <code>onBeforeStateChange</code> before the action and <code>onAfterStateChange</code> after the new state is loaded.</li>
<li><strong>Validation Errors</strong>: If the action fails due to invalid input (e.g., wrong format or length), <code>newState.error</code> will be set to &quot;invalid_form_data&quot;, and specific errors will be attached to the related input fields (see &quot;Error Handling&quot; below).</li>
</ul>
<h3>Event Handlers</h3>
<p>The SDK dispatches events via the Hanko instance to track state changes.</p>
<h4><code>onBeforeStateChange</code></h4>
<p>Fires before an action is executed, useful for showing loading states.</p>
<pre class="prettyprint source lang-typescript"><code>hanko.onBeforeStateChange(({ state }) => {
  console.log(&quot;Action loading:&quot;, state.invokedAction);
});
</code></pre>
<h4><code>onAfterStateChange</code></h4>
<p>Fires after a new state is loaded, ideal for rendering UI or handling state-specific logic.</p>
<pre class="prettyprint source lang-typescript"><code>hanko.onAfterStateChange(({ state }) => {
  console.log(&quot;Action load finished:&quot;, state.invokedAction);

  switch (state.name) {
    case &quot;login_init&quot;:
      state.passkeyAutofillActivation(); // Special handler for passkey autofill; requires an &lt;input> field on the page with `autocomplete=&quot;username webauthn&quot;` (e.g., &lt;input type=&quot;text&quot; name=&quot;username&quot; autocomplete=&quot;username webauthn&quot; />) so the browser can suggest and autofill passkeys when the user interacts with it.
      break;
    case &quot;login_password&quot;:
      // Render password input UI
      if (state.error) {
        console.log(&quot;Error:&quot;, state.error); // e.g., &quot;invalid_form_data&quot;
      }
      break;
    case &quot;error&quot;:
      // Handle network errors or 5xx responses
      console.error(&quot;Flow error:&quot;, state.error);
      break;
  }
});
</code></pre>
<h3>Controlling the AfterStateChanged Event</h3>
<p>You can disable the automatic <code>onAfterStateChange</code> event and dispatch it manually after custom logic.</p>
<pre class="prettyprint source lang-typescript"><code>if (state.name === &quot;login_init&quot;) {
  const newState = await state.actions.continue_with_login_identifier.run(
    { username: &quot;user1&quot; },
    { dispatchAfterStateChangeEvent: false }, // Disable automatic dispatch
  );
  // Only `onBeforeStateChange` is triggered here

  await doSomething(); // Your custom async logic
  newState.dispatchAfterStateChangeEvent(); // Manually trigger the event
}
</code></pre>
<h3>Auto-Steps</h3>
<p>Auto-steps automatically advance the flow for certain states, reducing manual intervention.</p>
<h4>Supported States</h4>
<ul>
<li><code>preflight</code></li>
<li><code>login_passkey</code></li>
<li><code>onboarding_verify_passkey_attestation</code></li>
<li><code>webauthn_credential_verification</code></li>
<li><code>thirdparty</code></li>
<li><code>success</code></li>
<li><code>account_deleted</code></li>
</ul>
<h4>Disabling Auto-Steps</h4>
<p>Prevent auto-steps by specifying states in <code>excludeAutoSteps</code>:</p>
<pre class="prettyprint source lang-typescript"><code>const state = await hanko.createState(&quot;login&quot;, {
  excludeAutoSteps: [&quot;success&quot;], // Skip auto-step for &quot;success&quot;
});
</code></pre>
<h4>Manual Auto-Step Execution</h4>
<pre class="prettyprint source lang-typescript"><code>hanko.onAfterStateChange(({ state }) => {
  if (state.name === &quot;success&quot;) {
    console.log(&quot;Flow completed&quot;);
    await state.autoStep();
  }
});
</code></pre>
<h3>Error Handling</h3>
<h4>Input Errors</h4>
<p>If an action fails due to invalid inputs:</p>
<pre class="prettyprint source lang-typescript"><code>if (state.name === &quot;login_password&quot; && state.error === &quot;invalid_form_data&quot;) {
  const passwordError = state.actions.password_login.inputs.password.error;
  console.log(&quot;Password error:&quot;, passwordError);
}
</code></pre>
<h4>Network/API Errors</h4>
<p>For network issues or <code>5xx</code> responses, the <code>error</code> state is entered with details in <code>state.error</code>.</p>
<pre class="prettyprint source lang-typescript"><code>if (state.name === &quot;error&quot;) {
    console.error(&quot;Flow error:&quot;, state.error);
}
</code></pre>
<h3>Caching Flow State</h3>
<p>Persist and recover flow state using <code>localStorage</code>.</p>
<h4>Saving State</h4>
<p>Save the current flow state to <code>localStorage</code> using <code>saveToLocalStorage()</code>.</p>
<pre class="prettyprint source lang-typescript"><code>state.saveToLocalStorage(); // Stores under `state.cacheKey` (default: &quot;hanko-flow-state&quot;)
</code></pre>
<p>Please note that the <code>localStorage</code> entry will be removed automatically when an action is invoked on the saved state.</p>
<h4>Loading State</h4>
<p>Recover a cached state or start a new flow:</p>
<pre class="prettyprint source lang-typescript"><code>const state = await hanko.createState(&quot;login&quot;, {
    loadFromCache: true, // Attempts to load from `cacheKey`
    cacheKey: &quot;hanko-flow-state&quot;,
});
</code></pre>
<h4>Clearing State</h4>
<p>Remove the cached state:</p>
<pre class="prettyprint source lang-typescript"><code>state.removeFromLocalStorage(); // Deletes from `state.cacheKey`
</code></pre>
<h4>Advanced Serialization</h4>
<p>For custom persistence:</p>
<pre class="prettyprint source lang-typescript"><code>import { State } from &quot;@teamhanko/hanko-frontend-sdk&quot;;

const serialized = state.serialize(); // Returns a `SerializedState` object
// Store `serialized` in your storage system

// Later, deserialize it
const recoveredState = await State.deserialize(hanko, serialized, {
    cacheKey: &quot;custom-key&quot;,
});
</code></pre>
<p>This allows integration with other storage mechanisms.</p>
<h2>Bugs</h2>
<p>Found a bug? Please report on our <a href="https://github.com/teamhanko/hanko/issues">GitHub</a> page.</p>
<h2>Documentation</h2>
<p>To see the latest documentation, please click <a href="https://teamhanko.github.io/hanko/jsdoc/hanko-frontend-sdk/">here</a>.</p>
<h2>License</h2>
<p>The <code>hanko-frontend-sdk</code> project is licensed under the <a href="LICENSE">MIT License</a>.</p></article>
    </section>






            </div>
            
            <footer class="footer">
                <div class="content has-text-centered">
                    <p>Documentation generated by <a href="https://github.com/jsdoc3/jsdoc">JSDoc 3.6.11</a></p>
                    <p class="sidebar-created-by">
                        <a href="https://github.com/SoftwareBrothers/better-docs" target="_blank">BetterDocs theme</a> provided with <i class="fas fa-heart"></i> by
                        <a href="http://softwarebrothers.co" target="_blank">SoftwareBrothers - JavaScript Development Agency</a>
                    </p>
                </div>
            </footer>
            
        </div>
        <div id="side-nav" class="side-nav">
        </div>
    </div>
<script src="scripts/app.min.js"></script>
<script>PR.prettyPrint();</script>
<script src="scripts/linenumber.js"> </script>


</body>
</html>